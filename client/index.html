<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Open+Sans:wght@400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Display:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playwrite+GB+S:ital,wght@0,100..400;1,100..400&display=swap" rel="stylesheet">
    
    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> 

    <link rel="stylesheet" href="./style.css" />
    <title>Travel News Blog</title>
</head>
<body>
    <div class="container">
        <header>
            <div class="title">
                <h1>Travel News</h1>
                <h2>Exclusive website with tips for your trips</h2>
            </div>
            <nav>
                <ul>
                    <li><a href="./index.html">Home</a></li>
                    <li><a href="./index.html">About Me</a></li>
                    <li><a href="./createPost.html">Create Post</a></li>
                    <li><a href="./editPost.html">Edit Post</a></li>
                    <li><a href="./deletePost.html">Delete Post</a></li>
                </ul>
            </nav>
        </header>
        <main>
            <div id="post-list"><!-- List of Posts will be populated here --></div>
            <div class="postcard">
                <div class="col-1"><img src="./img/winter.png" width="280" height="365" /></div>
                <div class="col-2"><img src="./img/postcard-divider.png" width="30" height="360" /></div>
                <div class="col-3">
                    <img src="./img/about-par-avion-stamp.png" width="80" height="80" class="imgRight">
                    <img src="./img/About-Stamp-Autumn.png" width="175" height="105">
                    <h4>About Me</h4>
                    <p>Hi, I’m Aline! I’ve spent the past 10 years living in different cities across Canada, and I’ve finally found my place in beautiful Alberta. I’m passionate about front-end development, where I enjoy building engaging, interactive web experiences.</p>
                    <p>Now based in Calgary, near the majestic Rockies, I’m able to indulge in one of my favorite hobbies—skiing. Whether I’m coding or hitting the slopes, I’m always eager to embrace new challenges and adventures.</p>
                </div>
            </div>
        </main>
        <footer>
            <div class="line"></div>
            <div class="lineName"> Blog by Aline Muller </div>
            <div class="line"></div>
        </footer>
    </div>
    <script >
        // Fetch and display posts from newest to oldest
        async function fetchPosts() {
            try {
                const response = await axios.get('http://localhost:3001/posts'); 
                let posts = response.data.data;

                if (Array.isArray(posts) && posts.length > 0) {
                    // Sort posts by date from newest to oldest
                    posts.sort((a, b) => new Date(b.date) - new Date(a.date));
                    displayPosts(posts);
                } else {
                    document.getElementById('post-list').innerHTML = '<p>No posts available.</p>';
                }
            } catch (error) {
                console.error('Error fetching posts:', error);
                document.getElementById('post-list').innerHTML = '<p>Error fetching posts.</p>';
            }
        }

        // Function to display posts on the page
        async function displayPosts(posts) {
            
            const postList = document.getElementById('post-list');
            postList.innerHTML = '';

            for (const post of posts) {

                const responseAuthor = await axios.get(`http://localhost:3001/authors/${post.author}`); 
                let author = responseAuthor.data.data

                console.log(author)
               
                const postItem = document.createElement('div');
                postItem.classList.add('postItem');

            

                postItem.innerHTML = `
                    <h3>${post.title}</h3>
                    <div class="image"><img src="${post.image}" />
                    <div>${post.content}</div>
                    <div class="author"> ${author.name} - ${new Date(post.date).toLocaleDateString()}</div>    
                `;
                postList.appendChild(postItem);
                // 
            }
        }
        fetchPosts();
    </script>
</body>
</html>
